# 代码审查规范文档

> **版本**: v1.0.0  
> **最后更新**: 2024-11-18

## 1. 概述

本文档定义了AI能力交易平台的代码审查规范，包括审查流程、检查清单、反馈规范等。

## 2. 审查流程

### 2.1 Pull Request流程

1. **创建PR**: 开发完成后创建PR
2. **自动检查**: CI自动运行检查
3. **代码审查**: 至少1人审查
4. **修改完善**: 根据反馈修改
5. **批准合并**: 审查通过后合并

### 2.2 审查时间要求

- **小变更（<100行）**: 24小时内审查
- **中等变更（100-500行）**: 48小时内审查
- **大变更（>500行）**: 72小时内审查
- **紧急修复**: 4小时内审查

## 3. 审查检查清单

### 3.1 代码质量

- [ ] 代码符合规范（ESLint/Prettier）
- [ ] 无明显的Bug
- [ ] 错误处理完善
- [ ] 边界情况处理
- [ ] 性能考虑合理
- [ ] 内存泄漏检查

### 3.2 功能完整性

- [ ] 功能按需求实现
- [ ] 测试用例充分
- [ ] 测试通过
- [ ] 用户体验良好
- [ ] 响应式适配

### 3.3 安全性

- [ ] 输入验证完善
- [ ] SQL注入防护
- [ ] XSS防护
- [ ] 权限验证
- [ ] 敏感信息保护

### 3.4 文档

- [ ] 代码注释完善
- [ ] API文档更新
- [ ] README更新（如需要）
- [ ] CHANGELOG更新

### 3.5 测试

- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 测试覆盖率达标
- [ ] 手动测试完成

## 4. 审查重点

### 4.1 架构设计

- 设计是否合理
- 是否符合规范
- 是否可扩展
- 是否可维护

### 4.2 代码实现

- 实现是否正确
- 是否有更好的实现
- 是否有重复代码
- 是否遵循DRY原则

### 4.3 性能考虑

- 是否有性能问题
- 是否有不必要的查询
- 是否有缓存机会
- 是否有优化空间

### 4.4 安全性

- 是否有安全漏洞
- 是否有权限问题
- 是否有数据泄露风险

## 5. 审查反馈规范

### 5.1 反馈原则

- **建设性**: 提供改进建议
- **尊重**: 尊重他人代码
- **具体**: 指出具体问题
- **及时**: 及时反馈

### 5.2 反馈格式

```markdown
**问题**: [简要描述问题]

**位置**: [文件路径:行号]

**建议**: [改进建议]

**示例**:
```typescript
// 建议的代码
```

**优先级**: [高/中/低]
```

### 5.3 反馈类型

#### 必须修改（Must Fix）

- 安全漏洞
- 功能Bug
- 规范违反

#### 建议修改（Should Fix）

- 代码优化
- 性能改进
- 可读性提升

#### 可选修改（Nice to Have）

- 代码风格
- 注释完善
- 重构建议

## 6. 常见问题检查

### 6.1 前端常见问题

- 未处理的Promise rejection
- 内存泄漏（事件监听器未清理）
- 不必要的重渲染
- 缺少错误边界
- 硬编码配置

### 6.2 后端常见问题

- N+1查询问题
- 缺少事务处理
- 错误处理不完善
- 缺少输入验证
- 日志记录敏感信息

## 7. 自动化检查

### 7.1 代码质量检查

```yaml
# .github/workflows/lint.yml
- name: Lint
  run: npm run lint

- name: Format Check
  run: npm run format:check

- name: Type Check
  run: npm run type-check
```

### 7.2 测试检查

```yaml
- name: Test
  run: npm run test

- name: Coverage
  run: npm run test:coverage
```

### 7.3 安全检查

```yaml
- name: Security Audit
  run: npm audit
```

## 8. 审查工具

### 8.1 代码审查工具

- **GitHub**: Pull Request Review
- **GitLab**: Merge Request Review
- **CodeRabbit**: AI代码审查

### 8.2 代码分析工具

- **SonarQube**: 代码质量分析
- **CodeClimate**: 代码质量评分
- **DeepSource**: 自动化代码审查

## 9. 审查最佳实践

### 9.1 审查者

- 仔细阅读代码
- 理解变更意图
- 提供建设性反馈
- 及时响应

### 9.2 提交者

- 代码自检
- 完善PR描述
- 及时响应反馈
- 保持沟通

## 10. 检查清单

- [ ] 审查流程明确
- [ ] 检查清单完善
- [ ] 反馈规范制定
- [ ] 自动化检查配置
- [ ] 审查工具配置
- [ ] 团队培训完成

---

**相关文档**:
- [Git工作流规范](./07-Git工作流规范.md)
- [后端代码规范](./03-后端代码规范.md)
- [前端开发补充规范](./16-前端开发补充规范.md)

