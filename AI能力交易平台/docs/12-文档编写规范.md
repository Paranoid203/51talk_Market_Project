# 文档编写规范文档

> **版本**: v1.0.0  
> **最后更新**: 2024-11-18

## 1. 概述

本文档定义了AI能力交易平台的文档编写规范，包括代码注释、README模板、API文档、变更日志等。

## 2. 代码注释规范

### 2.1 TypeScript/JavaScript注释

#### JSDoc注释（函数）

```typescript
/**
 * 获取工具列表
 * @param query - 查询参数
 * @param query.page - 页码，默认1
 * @param query.limit - 每页数量，默认20
 * @param query.category - 分类筛选
 * @returns 工具列表和分页信息
 * @throws {ToolNotFoundException} 当工具不存在时
 * @example
 * ```typescript
 * const tools = await getTools({ page: 1, limit: 20 });
 * ```
 */
async function getTools(query: QueryToolDto): Promise<PaginatedResult<Tool>> {
  // ...
}
```

#### 类注释

```typescript
/**
 * 工具服务类
 * 负责工具相关的业务逻辑处理
 */
@Injectable()
export class ToolsService {
  // ...
}
```

#### 复杂逻辑注释

```typescript
// 计算工具评分：加权平均（新评价权重更高）
const weightedRating = reviews.reduce((sum, review, index) => {
  const weight = index < 10 ? 1.2 : 1.0; // 前10条评价权重1.2
  return sum + review.rating * weight;
}, 0) / reviews.length;
```

### 2.2 注释原则

- **为什么**而不是**是什么**: 解释原因而非实现
- **复杂逻辑必注释**: 算法、业务规则
- **公共API必注释**: 所有公开的函数、类
- **避免冗余注释**: 代码已清晰表达的不需要注释

## 3. README规范

### 3.1 README结构

```markdown
# 项目名称

简短的项目描述（1-2句话）

## 功能特性

- 功能1
- 功能2
- 功能3

## 技术栈

- React 18 + TypeScript
- NestJS + Prisma
- PostgreSQL + Redis

## 快速开始

### 前置要求

- Node.js 20+
- PostgreSQL 15+
- Redis 7+

### 安装

\`\`\`bash
npm install
\`\`\`

### 运行

\`\`\`bash
# 开发环境
npm run dev

# 生产环境
npm run build
npm start
\`\`\`

## 项目结构

\`\`\`
project/
├── src/
├── docs/
└── ...
\`\`\`

## 开发指南

参见 [开发文档](./docs/)

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交变更
4. 创建Pull Request

## 许可证

MIT License
```

## 4. API文档规范

### 4.1 Swagger文档

使用Swagger自动生成API文档：

```typescript
@ApiTags('tools')
@Controller('tools')
export class ToolsController {
  @ApiOperation({ 
    summary: '获取工具列表',
    description: '支持分页、搜索、筛选'
  })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'limit', required: false, type: Number })
  @ApiResponse({ 
    status: 200, 
    description: '成功返回工具列表',
    type: PaginatedToolDto
  })
  @Get()
  async findAll(@Query() query: QueryToolDto) {
    // ...
  }
}
```

### 4.2 API文档要求

- 所有接口必须有文档
- 包含请求参数说明
- 包含响应示例
- 包含错误码说明
- 包含认证要求

## 5. 变更日志（CHANGELOG）

### 5.1 CHANGELOG格式

```markdown
# Changelog

## [1.0.0] - 2024-11-18

### Added
- 工具广场功能
- 需求广场功能
- 项目广场功能
- 用户认证功能

### Changed
- 优化搜索性能
- 改进UI设计

### Fixed
- 修复登录token过期问题
- 修复工具列表分页bug

### Security
- 修复SQL注入漏洞
```

### 5.2 变更类型

- **Added**: 新功能
- **Changed**: 功能变更
- **Deprecated**: 废弃功能
- **Removed**: 移除功能
- **Fixed**: Bug修复
- **Security**: 安全修复

## 6. 技术文档规范

### 6.1 技术方案文档

```markdown
# 技术方案：工具搜索功能

## 背景

当前工具列表不支持搜索，用户难以快速找到需要的工具。

## 目标

实现工具搜索功能，支持关键词搜索和高级筛选。

## 方案设计

### 方案一：数据库全文搜索
- 优点：实现简单
- 缺点：性能有限

### 方案二：Elasticsearch
- 优点：性能好，功能强大
- 缺点：需要额外服务

## 推荐方案

推荐使用方案一（数据库全文搜索），满足当前需求。

## 实施计划

1. 数据库添加全文搜索索引
2. 后端实现搜索API
3. 前端实现搜索UI
4. 测试验证

## 风险评估

- 性能风险：低
- 技术风险：低
```

## 7. 问题排查文档

### 7.1 问题记录模板

```markdown
# 问题：用户登录失败

## 问题描述
用户反馈登录时提示"Token过期"错误。

## 环境信息
- 浏览器：Chrome 120
- 操作系统：Windows 11
- 时间：2024-11-18 10:00

## 复现步骤
1. 打开登录页面
2. 输入用户名密码
3. 点击登录
4. 出现错误提示

## 错误信息
```
Error: Token expired
at AuthService.login (auth.service.ts:45)
```

## 解决方案
更新JWT过期时间配置。

## 相关Issue
#123
```

## 8. 文档维护

### 8.1 更新原则

- 代码变更时同步更新文档
- 定期审查文档准确性
- 删除过时文档
- 保持文档简洁

### 8.3 禁止添加演示文件

**重要规则**：未经用户主动要求，**严禁**在项目中添加以下类型的文件：

- ❌ 测试文档（如：`测试.md`、`test-*.md`）
- ❌ 演示操作文件（如：`演示.md`、`demo-*.md`）
- ❌ 临时修复文档（如：`修复*.md`、`✅*.md`）
- ❌ 快速参考文档（如：`快速*.md`、`立即*.md`）
- ❌ 调试文档（如：`调试*.md`、`排查*.md`）

**允许的文档类型**：
- ✅ 正式规范文档（放在`docs/`目录）
- ✅ README.md（项目主文档）
- ✅ CHANGELOG.md（变更日志）
- ✅ 用户主动要求创建的文档

**违反此规则的处理**：
- 代码审查时直接拒绝
- 要求立即删除违规文件
- 记录到代码审查记录中

### 8.2 文档审查

- 代码审查时检查文档
- 定期文档审查会议
- 用户反馈收集

## 9. 文档工具

### 9.1 文档生成工具

- **API文档**: Swagger/OpenAPI
- **代码文档**: TypeDoc
- **Markdown**: Markdownlint

### 9.2 文档托管

- **内部文档**: Git仓库
- **API文档**: Swagger UI
- **用户文档**: 文档站点

## 10. 检查清单

- [ ] 代码注释规范
- [ ] README完善
- [ ] API文档完整
- [ ] CHANGELOG更新
- [ ] 技术文档规范
- [ ] 问题排查文档
- [ ] 文档维护机制
- [ ] 文档工具配置

---

**相关文档**:
- [API规范](./01-API规范.md)
- [后端代码规范](./03-后端代码规范.md)


- **API文档**: Swagger UI
- **用户文档**: 文档站点

## 10. 检查清单

- [ ] 代码注释规范
- [ ] README完善
- [ ] API文档完整
- [ ] CHANGELOG更新
- [ ] 技术文档规范
- [ ] 问题排查文档
- [ ] 文档维护机制
- [ ] 文档工具配置

---

**相关文档**:
- [API规范](./01-API规范.md)
- [后端代码规范](./03-后端代码规范.md)

