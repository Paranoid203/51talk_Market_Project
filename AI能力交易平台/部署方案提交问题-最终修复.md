# éƒ¨ç½²æ–¹æ¡ˆæäº¤é—®é¢˜ - æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜ç°è±¡

ç”¨æˆ·åœ¨"ç”³è¯·éƒ¨ç½²æ–¹æ¡ˆ"è¡¨å•æäº¤æ—¶,åç«¯è¿”å› **500 (Internal Server Error)**,é”™è¯¯ä¿¡æ¯åªæ˜¾ç¤º "Internal server error",æ— è¯¦ç»†ä¿¡æ¯ã€‚

## ğŸ” æ ¹æœ¬åŸå› 

ç»è¿‡æ·±åº¦åˆ†æ,å‘ç°ä¸»è¦åŸå› æ˜¯:

### 1. **ç©ºå­—ç¬¦ä¸²å¯¼è‡´çš„æ•°æ®åº“çº¦æŸé—®é¢˜**
   - å‰ç«¯è¡¨å•ä¸­çš„å¯é€‰å­—æ®µ(å¦‚ `targetLaunchDate`)å¦‚æœæœªå¡«å†™,ä¼šå‘é€ç©ºå­—ç¬¦ä¸² `""`
   - åç«¯ç›´æ¥å°†ç©ºå­—ç¬¦ä¸²æ’å…¥æ•°æ®åº“
   - æŸäº›æ•°æ®åº“å­—æ®µå¯èƒ½æœ‰æ ¼å¼çº¦æŸæˆ–è§¦å‘å™¨,å¯¼è‡´æ’å…¥å¤±è´¥

### 2. **åç«¯é”™è¯¯æ—¥å¿—ä¸å®Œæ•´**
   - åŸServiceå±‚æ²¡æœ‰try-catchåŒ…è£¹Prismaæ“ä½œ
   - é”™è¯¯è¢«å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨æ•è·,åªè¿”å›é€šç”¨é”™è¯¯ä¿¡æ¯
   - å¼€å‘è€…æ— æ³•ä»åç«¯æ§åˆ¶å°çœ‹åˆ°å…·ä½“é”™è¯¯åŸå› 

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: å‰ç«¯æ•°æ®æ¸…ç†(æ¨è)

**æ–‡ä»¶**: `src/components/ProjectDetail.tsx`

åœ¨å‘é€è¯·æ±‚å‰,**æ¸…ç†ç©ºå­—ç¬¦ä¸²å­—æ®µ**,åªå‘é€æœ‰å€¼çš„å­—æ®µ:

```typescript
// âœ… æ¸…ç†æ•°æ®ï¼šç§»é™¤ç©ºå­—ç¬¦ä¸²å­—æ®µ
const requestData: any = {
  applicantName: deployForm.applicantName,
  department: deployForm.department,
  email: deployForm.email,
  businessScenario: deployForm.businessScenario,
  urgency: deployForm.urgency || 'normal',
};

// åªæ·»åŠ éç©ºçš„å¯é€‰å­—æ®µ
if (deployForm.contactPhone && deployForm.contactPhone.trim()) {
  requestData.contactPhone = deployForm.contactPhone.trim();
}
if (deployForm.teamSize && deployForm.teamSize.trim()) {
  requestData.teamSize = deployForm.teamSize.trim();
}
if (deployForm.targetLaunchDate && deployForm.targetLaunchDate.trim()) {
  requestData.targetLaunchDate = deployForm.targetLaunchDate.trim();
}
if (deployForm.expectedGoals && deployForm.expectedGoals.trim()) {
  requestData.expectedGoals = deployForm.expectedGoals.trim();
}
if (deployForm.budgetRange && deployForm.budgetRange.trim()) {
  requestData.budgetRange = deployForm.budgetRange.trim();
}
if (deployForm.additionalNeeds && deployForm.additionalNeeds.trim()) {
  requestData.additionalNeeds = deployForm.additionalNeeds.trim();
}
```

**ä¼˜ç‚¹**:
- âœ… ä¸å‘é€æ— ç”¨çš„ç©ºå­—ç¬¦ä¸²
- âœ… å‡å°‘ç½‘ç»œä¼ è¾“æ•°æ®é‡
- âœ… é¿å…åç«¯å¤„ç†ç©ºå€¼çš„å¤æ‚é€»è¾‘
- âœ… ç¬¦åˆAPIæœ€ä½³å®è·µ

### æ–¹æ¡ˆ2: åç«¯ç©ºå€¼å¤„ç†

**æ–‡ä»¶**: `backend/src/modules/projects/projects.service.ts`

å°†ç©ºå­—ç¬¦ä¸²è½¬ä¸º `undefined`:

```typescript
const replication = await this.prisma.projectReplication.create({
  data: {
    projectId,
    replicatorId: userId,
    departmentId,
    applicantName: applyDto.applicantName,
    department: applyDto.department,
    contactPhone: applyDto.contactPhone || undefined,  // âœ… ç©ºå­—ç¬¦ä¸² â†’ undefined
    email: applyDto.email,
    teamSize: applyDto.teamSize || undefined,
    urgency: applyDto.urgency || 'normal',
    targetLaunchDate: applyDto.targetLaunchDate || undefined,  // âœ… ç©ºå­—ç¬¦ä¸² â†’ undefined
    businessScenario: applyDto.businessScenario,
    expectedGoals: applyDto.expectedGoals || undefined,
    budgetRange: applyDto.budgetRange || undefined,
    additionalNeeds: applyDto.additionalNeeds || undefined,
    status: 'APPLIED',
  },
  // ...
});
```

### æ–¹æ¡ˆ3: å¢å¼ºé”™è¯¯æ—¥å¿—

**æ–‡ä»¶**: `backend/src/modules/projects/projects.service.ts`

æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ•è·å’Œæ—¥å¿—:

```typescript
console.log('ğŸ“ [Service] å‡†å¤‡åˆ›å»ºç”³è¯·è®°å½•...');
try {
  const replication = await this.prisma.projectReplication.create({...});
  console.log('âœ… [Service] ç”³è¯·è®°å½•åˆ›å»ºæˆåŠŸï¼');
  return replication;
} catch (error) {
  console.error('âŒ [Service] Prismaåˆ›å»ºè®°å½•å¤±è´¥ï¼');
  console.error('  - é”™è¯¯ç±»å‹:', error.constructor.name);
  console.error('  - é”™è¯¯ä¿¡æ¯:', error.message);
  console.error('  - é”™è¯¯ä»£ç :', error.code);
  console.error('  - å®Œæ•´é”™è¯¯:', error);
  throw new Error(`åˆ›å»ºç”³è¯·è®°å½•å¤±è´¥: ${error.message}`);
}
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. å‰ç«¯ä¿®å¤(å·²å®Œæˆ)
```bash
# å‰ç«¯ä»£ç å·²è‡ªåŠ¨çƒ­æ›´æ–°,æ— éœ€é‡å¯
# åˆ·æ–°æµè§ˆå™¨é¡µé¢å³å¯
```

### 2. åç«¯ä¿®å¤(éœ€è¦é‡å¯)

**æ­¥éª¤1: é‡æ–°ç¼–è¯‘**
```bash
cd backend
npm run build
```

**æ­¥éª¤2: åœæ­¢æ—§æœåŠ¡**
- æ‰¾åˆ°è¿è¡Œåç«¯çš„ç»ˆç«¯çª—å£
- æŒ‰ `Ctrl+C` åœæ­¢æœåŠ¡

**æ­¥éª¤3: å¯åŠ¨æ–°æœåŠ¡**
```bash
npm run start:dev
```

**æ­¥éª¤4: ç¡®è®¤æœåŠ¡å¯åŠ¨æˆåŠŸ**
çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸ:
```
[Nest] INFO  [NestApplication] Nest application successfully started
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1: æœ€å°å¿…å¡«é¡¹æµ‹è¯•

1. æ‰“å¼€é¡¹ç›®è¯¦æƒ…é¡µ
2. ç‚¹å‡»"ç”³è¯·éƒ¨ç½²æ–¹æ¡ˆ"
3. **åªå¡«å†™å¿…å¡«é¡¹**:
   - âœ… ç”³è¯·äººå§“å: "æµ‹è¯•ç”¨æˆ·"
   - âœ… éƒ¨é—¨: "æµ‹è¯•éƒ¨é—¨"
   - âœ… ç”µå­é‚®ä»¶: "test@example.com"
   - âœ… ä¸šåŠ¡åœºæ™¯: "æµ‹è¯•ä¸šåŠ¡åœºæ™¯æè¿°"
4. **ä¸å¡«å†™å¯é€‰é¡¹**(ç•™ç©º)
5. ç‚¹å‡»"æäº¤ç”³è¯·"
6. **é¢„æœŸç»“æœ**: æäº¤æˆåŠŸ,æ˜¾ç¤ºæˆåŠŸæç¤º

### æµ‹è¯•2: å®Œæ•´è¡¨å•æµ‹è¯•

1. æ‰“å¼€é¡¹ç›®è¯¦æƒ…é¡µ
2. ç‚¹å‡»"ç”³è¯·éƒ¨ç½²æ–¹æ¡ˆ"
3. **å¡«å†™æ‰€æœ‰å­—æ®µ**:
   - ç”³è¯·äººå§“å
   - éƒ¨é—¨
   - è”ç³»ç”µè¯
   - ç”µå­é‚®ä»¶
   - å›¢é˜Ÿè§„æ¨¡
   - ç´§æ€¥ç¨‹åº¦
   - ç›®æ ‡ä¸Šçº¿æ—¥æœŸ
   - ä¸šåŠ¡åœºæ™¯
   - é¢„æœŸç›®æ ‡
   - é¢„ç®—èŒƒå›´
   - å…¶ä»–éœ€æ±‚
4. ç‚¹å‡»"æäº¤ç”³è¯·"
5. **é¢„æœŸç»“æœ**: æäº¤æˆåŠŸ,æ˜¾ç¤ºæˆåŠŸæç¤º

### æµ‹è¯•3: é‚®ç®±éªŒè¯æµ‹è¯•

1. å¡«å†™è¡¨å•,é‚®ç®±ç•™ç©º
2. ç‚¹å‡»æäº¤
3. **é¢„æœŸç»“æœ**: æ˜¾ç¤º"è¯·å¡«å†™æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€"

4. é‚®ç®±å¡«å†™ä¸º "invalid-email"
5. ç‚¹å‡»æäº¤
6. **é¢„æœŸç»“æœ**: æ˜¾ç¤º"è¯·è¾“å…¥æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€"

## ğŸ“Š é¢„æœŸæ—¥å¿—è¾“å‡º

### å‰ç«¯æ—¥å¿—(æµè§ˆå™¨æ§åˆ¶å° F12)

**æˆåŠŸæ—¶**:
```
==================== å¼€å§‹æäº¤éƒ¨ç½²ç”³è¯· ====================
ğŸ“‹ ç”³è¯·ä¿¡æ¯:
  é¡¹ç›®ID: 35
  é¡¹ç›®æ ‡é¢˜: xxx
  ç”³è¯·äººå§“å: Lycan
  ...
ğŸ“¤ æ­£åœ¨å‘é€APIè¯·æ±‚...
ğŸ“¦ è¯·æ±‚æ•°æ®: {
  "applicantName": "Lycan",
  "department": "AIæ•ˆç‡ä¸­å¿ƒ",
  "email": "guhongjii@51talk.com",
  "businessScenario": "...",
  "urgency": "normal",
  "contactPhone": "16622763282",  // âœ… åªåŒ…å«éç©ºå­—æ®µ
  ...
}
âœ… APIè¯·æ±‚æˆåŠŸï¼
ğŸ“¥ æœåŠ¡å™¨å“åº”: { id: 123, status: "APPLIED", ... }
```

### åç«¯æ—¥å¿—(åç«¯æ§åˆ¶å°)

**æˆåŠŸæ—¶**:
```
ğŸŒ [Controller] æ”¶åˆ°éƒ¨ç½²ç”³è¯·è¯·æ±‚
  - URL: POST /projects/:id/replicate
  - projectId: 35
  - userId: 8
ğŸ”§ [Service] applyReplication å¼€å§‹å¤„ç†
  - projectId: 35
  - userId: 8
  - applyDto: {...}
âœ… [Service] é¡¹ç›®å­˜åœ¨: # æ–°å»ºé¡¹ç›® - æ¨¡æ‹Ÿæ•°æ®è¡¨
âœ… [Service] æ‰¾åˆ°éƒ¨é—¨: AIæ•ˆç‡ä¸­å¿ƒ (ID: 2)
ğŸ“ [Service] å‡†å¤‡åˆ›å»ºç”³è¯·è®°å½•...
âœ… [Service] ç”³è¯·è®°å½•åˆ›å»ºæˆåŠŸï¼
  - replicationId: 123
  - ç”³è¯·äºº: Lycan
  - çŠ¶æ€: APPLIED
```

**å¤±è´¥æ—¶**:
```
âŒ [Service] Prismaåˆ›å»ºè®°å½•å¤±è´¥ï¼
  - é”™è¯¯ç±»å‹: PrismaClientKnownRequestError
  - é”™è¯¯ä¿¡æ¯: Invalid value for field ...
  - é”™è¯¯ä»£ç : P2000
  - å®Œæ•´é”™è¯¯: [è¯¦ç»†å †æ ˆ]
```

## ğŸ› é—®é¢˜æ’æŸ¥æŒ‡å—

### é—®é¢˜1: ä»ç„¶æç¤º500é”™è¯¯

**å¯èƒ½åŸå› **:
1. âŒ åç«¯æ²¡æœ‰é‡å¯
2. âŒ æ•°æ®åº“è¿æ¥é—®é¢˜
3. âŒ ç”¨æˆ·æƒé™é—®é¢˜
4. âŒ æ•°æ®åº“å­—æ®µçº¦æŸé—®é¢˜

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥åç«¯æ˜¯å¦å·²é‡å¯(`Ctrl+C` ç„¶å `npm run start:dev`)
2. æŸ¥çœ‹åç«¯æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯æ—¥å¿—
3. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æ­£å¸¸è¿æ¥
4. ç¡®è®¤ç”¨æˆ·tokenæ˜¯å¦æœ‰æ•ˆ(401é”™è¯¯)

### é—®é¢˜2: å‰ç«¯æ²¡æœ‰æ˜¾ç¤ºé”™è¯¯æ—¥å¿—

**è§£å†³æ–¹æ¡ˆ**:
1. æŒ‰ `F12` æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° `Console` æ ‡ç­¾
3. æ¸…ç©ºæ—¥å¿—(ç‚¹å‡»ğŸš«å›¾æ ‡)
4. é‡æ–°æäº¤è¡¨å•
5. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

### é—®é¢˜3: åç«¯æ²¡æœ‰æ˜¾ç¤ºæ—¥å¿—

**å¯èƒ½åŸå› **:
- åç«¯æ²¡æœ‰é‡å¯,è¿˜åœ¨è¿è¡Œæ—§ä»£ç 

**è§£å†³æ–¹æ¡ˆ**:
1. å®Œå…¨åœæ­¢åç«¯æœåŠ¡(`Ctrl+C`)
2. é‡æ–°ç¼–è¯‘: `npm run build`
3. é‡æ–°å¯åŠ¨: `npm run start:dev`

## ğŸ“ ä¿®å¤å†…å®¹æ€»ç»“

### å‰ç«¯ä¿®å¤
- âœ… æ·»åŠ é‚®ç®±å¿…å¡«éªŒè¯
- âœ… æ·»åŠ é‚®ç®±æ ¼å¼éªŒè¯
- âœ… UIæ ‡è®°é‚®ç®±ä¸ºå¿…å¡«é¡¹
- âœ… **æ¸…ç†ç©ºå­—ç¬¦ä¸²å­—æ®µ,åªå‘é€æœ‰å€¼çš„å­—æ®µ**

### åç«¯ä¿®å¤
- âœ… å°†ç©ºå­—ç¬¦ä¸²è½¬ä¸º undefined
- âœ… æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… Try-catchæ•è·Prismaé”™è¯¯
- âœ… è¾“å‡ºé”™è¯¯çš„è¯¦ç»†ä¿¡æ¯

## ğŸ“„ ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹çŠ¶æ€ | è¯´æ˜ |
|------|---------|------|
| `src/components/ProjectDetail.tsx` | âœ… å·²ä¿®å¤ | å‰ç«¯è¡¨å•éªŒè¯å’Œæ•°æ®æ¸…ç† |
| `backend/src/modules/projects/projects.service.ts` | âœ… å·²ä¿®å¤ | åç«¯æ•°æ®å¤„ç†å’Œé”™è¯¯æ—¥å¿— |
| `backend/src/modules/projects/dto/apply-replication.dto.ts` | ğŸ”µ æ— éœ€ä¿®æ”¹ | DTOå®šä¹‰æ­£ç¡® |
| `backend/src/modules/projects/projects.controller.ts` | ğŸ”µ æ— éœ€ä¿®æ”¹ | Controlleræ­£ç¡® |

## ğŸ¯ å…³é”®è¦ç‚¹

1. **å‰ç«¯æ•°æ®æ¸…ç†æœ€é‡è¦** - ä¸å‘é€ç©ºå­—ç¬¦ä¸²
2. **å¿…é¡»é‡å¯åç«¯æœåŠ¡** - ä»£ç ä¿®æ”¹åæ‰ä¼šç”Ÿæ•ˆ
3. **æŸ¥çœ‹åç«¯æ—¥å¿—** - å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
4. **é‚®ç®±æ˜¯å¿…å¡«é¡¹** - éœ€è¦å¡«å†™æœ‰æ•ˆçš„é‚®ç®±åœ°å€

## ğŸ“… ä¿®å¤æ—¶é—´

2025-11-25 (æœ€ç»ˆç‰ˆæœ¬)

---

**ç°åœ¨è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œ:**

1. âœ… **å‰ç«¯å·²è‡ªåŠ¨æ›´æ–°** - åˆ·æ–°æµè§ˆå™¨é¡µé¢å³å¯
2. âš ï¸ **åç«¯éœ€è¦æ‰‹åŠ¨é‡å¯** - æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤é‡å¯åç«¯æœåŠ¡
3. ğŸ§ª **é‡æ–°æµ‹è¯•** - å¡«å†™è¡¨å•å¹¶æäº¤
4. ğŸ“Š **æŸ¥çœ‹æ—¥å¿—** - åŒæ—¶æŸ¥çœ‹å‰ç«¯(F12)å’Œåç«¯æ§åˆ¶å°çš„æ—¥å¿—

**æµ‹è¯•æˆåŠŸåè¯·å‘Šè¯‰æˆ‘ç»“æœ!** ğŸš€

